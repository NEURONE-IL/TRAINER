<div
    *ngIf = "modules && modules.length > 0; else noModules"
    class = "moduleList"
>

  <!-- bonton continuar -->
  <div *ngIf="stageSuggestion">
    <button mat-raised-button color="primary" (click)="goToStage(stageSuggestion)"><mat-icon>play_arrow</mat-icon>{{ 'BUTTONS.CONTINUE' | translate }}</button>
  </div>

  <br>

  <!-- tabla modulos -->
  <table mat-table
    *ngIf="modules"
    [dataSource] = "modules" 
    class="mat-elevation-z4 tabla"
    multiTemplateDataRows  
  >

    <ng-container matColumnDef="NombreCol">
      <th mat-header-cell *matHeaderCellDef> {{ 'USER.MODULE_TABLE.NAME' | translate }} </th>
      <td mat-cell mat-list-item *matCellDef="let module"> <mat-icon *ngIf="flow.sorted" mat-list-icon>{{module.locked ? 'lock':'lock_open'}}</mat-icon><strong>{{module.name}}</strong> </td>
    </ng-container>

    <ng-container matColumnDef="TipoCol">
      <th mat-header-cell *matHeaderCellDef> {{ 'USER.MODULE_TABLE.PROGRESS' | translate }} </th>
      <td mat-cell *matCellDef="let module"> {{ getCompleted(module) }}</td>
    </ng-container>

    <ng-container matColumnDef="DescriptionCol">
      <th mat-header-cell *matHeaderCellDef> {{ 'USER.MODULE_TABLE.DESCRIPTION' | translate }} </th>
      <td class="descripcionFila"
          mat-cell 
          *matCellDef="let module"
      > 
        {{ module.description }}
        <mat-icon 
          class = "questionMark"
          (click)="openDialog($event, module)"
        >
          description
        </mat-icon>
      </td>
    </ng-container>

    <!-- Expanded content column -->
    <ng-container matColumnDef="showStages">
      <td mat-cell *matCellDef="let module" [attr.colspan]="3">
          <div class="showStages">
              <app-etapas
                [@detailExpand]="module._id == moduloID ? 'expanded' : 'collapsed'"
                [modulo] = module
                [sorted] = flow.sorted
                fxLayout = "row wrap"
                fxLayout.xs = "column center"
                fxLayoutAlign="space-evenly stretch"

                [(moduleID)]="moduloID"
                ></app-etapas>
          </div>

        <!-- <show-stages
          class = "showStages"
          [@detailExpand]="module == selectedModule ? 'expanded' : 'collapsed'"
          [modulo] = "module"
          [sorted] = "flow.sorted"
          [progress] = "progress"
        >
        </show-stages> -->
      </td>
    </ng-container>
    
    <tr mat-header-row *matHeaderRowDef="columnHeader"></tr>
    <tr class="filaModulo"
      mat-row *matRowDef="let row; columns: columnHeader;"
      (click)="!row.locked && enClick($event, row)"
      [class.isBlocked]="row.locked"
      [class.mat-row-is-clicked]="moduloID==row._id"
    ></tr>
    <tr mat-row *matRowDef="let fila; columns: ['showStages']" class="hidden"></tr>
  </table>
  <br>
</div>

<ng-template #noModules>
<h1>{{ 'USER.MODULE_TABLE.EMPTY' | translate }}</h1>
</ng-template>